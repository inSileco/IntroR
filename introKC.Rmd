---
title: "Introduction to R"
# subtitle: ""
author: "Marie-Hélène Brice & Kevin Cazelles"
date: "2019/26/03"
output:
  xaringan::moon_reader:
    includes:
      in_header: inSileco-header.html
    lib_dir: assets
    seal: false
    css: ["default", "inSileco.css", "inSileco-fonts.css"]
    nature:
      beforeInit: "inSileco-macros.js"
      highlightLines: false
---

```{r setup, echo = F}
## Setup for your presentation
library(knitr)

opts_chunk$set(
  eval = T,
  cache = T,
  comment = "#",
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  fig.width=5, fig.height=5,
  fig.align = 'center'
)


hook_output <- knit_hooks$get("output")
knit_hooks$set(output = function(x, options) {
  lines <- options$output.lines
  if (is.null(lines)) {
    return(hook_output(x, options))  # pass to default hook
  }
  x <- unlist(strsplit(x, "\n"))
  more <- "..."
  if (length(lines)==1) {        # first n lines
    if (length(x) > lines) {
      # truncate the output, but add ....
      x <- c(head(x, lines), more)
    }
  } else {
    x <- c(more, x[lines], more)
  }
  # paste these lines together
  x <- paste(c(x, ""), collapse = "\n")
  hook_output(x, options)
})
```

```{r, echo = F}
mypar = list(mar = c(3,3,1,0.5), mgp = c(1.6, 0.3, 0), tck = -.02, cex = 1.5)

options(repos=structure(c(CRAN="http://cran.r-project.org")))
```

```{r, include = FALSE}
if (!require(vegan)) install.packages("vegan")
library(vegan)
if (!require(ade4)) install.packages("ade4")
library(ade4)
if (!require(scales)) install.packages("scales")
library(scales)
```

---
# Aims

---
# Outline

### &nbsp; <i class="fa fa-commenting-o" aria-hidden="true"></i> R?
### &nbsp; <i class="fa fa-wrench" aria-hidden="true"></i> Data manipulations ~1h
### &nbsp; <i class="fa fa-bar-chart" aria-hidden="true"></i> Data visualization (part1) ~50min
### &nbsp; <i class="fa fa-cutlery" aria-hidden="true"></i> Lunch break 12pm
### &nbsp; <i class="fa fa-bar-chart" aria-hidden="true"></i> Data visualization (part2) ~30min
### &nbsp; <i class="fa fa-map" aria-hidden="true"></i> mapping ~ 1h30
### &nbsp; <i class="fa fa-coffee" aria-hidden="true"></i> *coffee break* 3pm
### &nbsp; <i class="fa fa-sitemap" aria-hidden="true"></i> ordination ~1h30



---
class: inverse, center, middle

# R?

## <i class="fa fa-commenting-o" aria-hidden="true"></i>


---
# R

<br>

> R is a programming language and free software environment for statistical computing and graphics [...].

<br>

> The R language is widely used among statisticians and data miners for developing statistical software and data analysis.

[R (programming language) - Wikipedia](https://en.wikipedia.org/wiki/R_(programming_language)


---
# R is popular

.center[![:scale 85%](images/redmonk.png)]

[Python](https://www.python.org/) / [Julia](https://julialang.org/)


---
# R is popular among Biological Sciences

### For instance

1. Ecologists
2. Bioinformatics [(Bioconductor)](https://www.bioconductor.org/)
3. Medicine [<i class="fa fa-external-link" aria-hidden="true"></i>](https://r-medicine.com/)

--

### Why?

1. An incredible tool for statistics
2. Fairly accessible for non-programmer people
3. A very high diversity of packages


---
# R is popular

.center[![:scale 72%](https://revolution-computing.typepad.com/.a/6a010534b1db25970b01b8d2594d25970c-800wi)]

[*CRAN now has 10,000 R packages* Revolutions. January, 2017](https://blog.revolutionanalytics.com/2017/01/cran-10000.html)

[MetaCRAN](https://www.r-pkg.org/) / [R Package Documentation](https://rdrr.io/)




---
# R, RStudio, Ropenscience?

### Main links

- [R project](https://www.r-project.org/)
- [CRAN](https://cran.r-project.org/)
- [RStudio](https://www.rstudio.com/)
- [rOpenSci](https://ropensci.org)

### Get reliable documentation

- [CRAN Manual & Contributed](https://cran.r-project.org/)
- [bookdown](https://bookdown.org/)
- [RStudio](https://www.rstudio.com/)
  - [Cheat Sheets](https://www.rstudio.com/resources/cheatsheets/)
  - [Webinars](https://resources.rstudio.com/webinars)
- [QCBS](https://qcbsrworkshops.github.io/Workshops/)
- [<i class="fa fa-stack-overflow" aria-hidden="true"></i>](https://stackoverflow.com/questions/tagged/r)




---
class: inverse, center, middle

# Data manipulation

## <i class="fa fa-wrench" aria-hidden="true"></i>



---
# Let's start
<br>

- Open R console / R GUI / RStudio / ...

--

- Install the following packages

```R
install.packages(c("tidyverse", "sf", "raster", "mapview", "vegan", "ade4",
  "scales", "xaringan"))
```

---
# R's principles
<br>


### 1. Everything in R is an object

### 2. Everything that happens in R is a function call

### 3. Interfaces to other software are part of R.


[Extending-R by Chambers](https://www.crcpress.com/Extending-R/Chambers/p/book/9781498775717)

---
# Everything in R is an object
<br>

```{R}
2
```

--

```{R}
class(2)
```
--

```{R}
class("A")
class(library)
plot
```

---
class: center
# Everything that happens in R is a function call
<br>

```R
class(2)
```
## <i class="fa fa-arrow-circle-o-down" aria-hidden="true"></i>

### `enter`

## <i class="fa fa-arrow-circle-o-down" aria-hidden="true"></i>

```{R, echo = FALSE}
class(2)
```


---
# Interfaces to other software are part of R
<br>

### Four examples among many others:

- [Rcpp](https://cran.r-project.org/web/packages/Rcpp/index.html)

- [Reticulate](https://rstudio.github.io/reticulate/index.html)

- [Rmarkdown](https://rmarkdown.rstudio.com/)

- [plotly](https://plot.ly/r/)

- [mapview](https://r-spatial.github.io/mapview/)


---
# Basic commands

```{R, basic1}
2+2
2*3
3>2
```

--

```{R, basic2}
let <- LETTERS[1:10]
let2 = LETTERS[1:10]
let
let2
identical(let, let2)
```

--
```{R, basic3}
let3 <- sample(let, 5)
let2
```

--

```R
# Functions documentation
?sample
```

---
# Vectors

**Create a vector**

```{R, basic4}
vec <- c(2:5, 9:12, 2)
vec
vec > 4
```

--

```{R, vec}
let
length(let)
```
--

**Subset a vector**

```{R, vec2}
let[1:2]
let[c(1:2, 5:6)]
let[-c(1,7)]
vec[vec > 4]
let[let > "C"]
```

---
# Matrices

```{R, mat}
# use arguments
mat <- matrix(1:18, ncol = 3, nrow = 6)
mat
mat[1,2]
```
--

```{R, mat2}
mat[1,]
mat[,2]
mat[2:4, 1:2]
```

---
# Data frames

## &nbsp; &nbsp; <i class="fa fa-question-circle-o" aria-hidden="true"></i>

--

```{R, dataframe}
df <- data.frame(
  letter = let[1:5],
  val = vec[1:5],
  logic = vec[1:5]>2
)
df
class(df)
```

---
# Data frames

```{R, dataframe2}
df[1, 1]
```

```{R, dataframe3}
df$letter
df[,1]
df[1]
df[1:2]
```

```{R, dataframe4}
class(df$letter)
class(df$val)
```

---
# Data frames
<br>

```{R}
library(datasets)
```

To see the list of available datasets:

```R
data()
```

To access the documentation of a particular dataset:

```R
?CO2
```


---
# Data frames

```{R}
library(datasets)
head(CO2)
names(CO2)
summary(CO2)
```

--

```{R}
CO2$Plant
```


---
# Lists

```{R}
mylist <- list(CO2 = CO2, mymat = mat, mylet = let[1], awesome = "cool")
names(mylist)
mylist$awesome
mylist[3:4]
```

--

```{R}
class(mylist[2])
class(mylist[[2]])
mylist[[2]]
class(mylist[[2]][2,3])
mylist[[2]][2,3]
```


---
# For loops

```{R}
for (i in 1:4) {
  # actions
  print(i)
}
```

```{R}
for (j in LETTERS[1:5]) {
  print(j)
}
```

```{R}
for (i in c(1,4,6)) {
  print(i)
}
```


---
# Logical conditions &nbsp; > &nbsp; >= &nbsp; < &nbsp; <= &nbsp; == &nbsp; !=

--

```{R}
vec <- c(2:5, 9:12, 2)
vec
vec[1] > 4
vec > 4
```

--

`if` ... `else` ...

```{R}
for (i in vec) {
  if (i <= 5) {
   # actions
   print(i)
 } else {
   print("nope")
 }
}
```




---
class: inverse, center, middle

# Questions?

## <i class="fa fa-question-circle-o" aria-hidden="true"></i>


---
# Tidyverse - a metapackage

<br>


```{R}
library(tidyverse)
```

### <i class="fa fa-wrench" aria-hidden="true"></i> A great tool belt for data science [<i class="fa fa-external-link" aria-hidden="true"></i>](https://www.tidyverse.org/)

--

- <i class="fa fa-check" aria-hidden="true"></i> Pros:
  - well-documented, intuitive
  - efficient
  - very popular

- <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>Cons:
  - an alternative way of doing the same manipulation things
  - prevents the user from learning programming basics


---
# Tidyverse - what will be used and covered



---
# Basic data manipulations

0. Read files

1. Filter

2. Select

3. Mutate

4. Aggregate

5. Joint

6. figure / write files



---
# Read a file

read.csv
readr::read_csv

read.table
package to connect to sql, mongodb,
XXX fchier speciaux geol??



---
# ade4

```{R}
library(ade4)
df <- data(doubs)
```

---
# Piping


---
# Filter

---
# Select

---
# Mutate

---
# Aggregate

---
# Joint

---
# Write files







---
class: inverse, center, middle

# Data visualization

## <i class="fa fa-bar-chart" aria-hidden="true"></i>


---
# graphics, grid and more



---
# ggplot2


---
# What's the big idea

1. grammar of graohics

2. yourplot <- gg_XX1 + gg_XX2 + gg_XX3

3. new plots? Code a new gg_XXX



---
# histograms


---
# pie chart

---
# get circular
