<!DOCTYPE html>
<html>
  <head>
    <title>Introduction to R</title>
    <meta charset="utf-8">
    <meta name="author" content="Marie-Hélène Brice &amp; Kevin Cazelles" />
    <link href="assets/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link rel="stylesheet" href="assets/font-awesome-4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="assets/academicons-1.8.1/css/academicons.min.css">
    <link rel="stylesheet" href="inSileco.css" type="text/css" />
    <link rel="stylesheet" href="inSileco-fonts.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">








class: inverse, center, middle

# Introduction to ordination

## Principal component analysis (PCA) &amp; Redundancy analysis (RDA)

---
# Ordination of multivariate data

&lt;br&gt;

.center[![:scale 70%](images/ordi1.png)]

---
# Ordination of multivariate data

&lt;br&gt;

.center[![:scale 70%](images/ordi2.png)]

---
# Ordination of multivariate data

&lt;br&gt;

.center[![:scale 70%](images/ordi3.png)]

---
# Unconstrained vs constrained ordinations

**Unconstrained ordination**

- Reveal the main patterns in multivariate data (e.g. matrix of species abundance at different sites or matrix of environmental variables at different sites)
- Describe relationship among variables of one matrix.
- Descriptive method: no statistical test

**Constrained/canonical ordination**

- Explicitly puts into relationship two matrices: one dependent matrix and one explanatory matrix. 
- This approach combines the techniques of ordination and multiple regression.
- Explanatory method: statistical test

&lt;br&gt;
*Both types of ordination are based upon a comparison of all possible pairs of objects (or descriptors) using association measures.*

---
# Unconstrained vs constrained ordinations

&lt;br&gt;

| Response data | Explanatory variables  | Analysis            |
|---------------|------------------------|---------------------|
| 1 variable    | 1 variable             | Simple regression   |
| 1 variable    | m variables            | Multiple regression |
| p variables   | -                      | Simple ordination   |
| p variables   | m variables            | Canonical ordination|

---
# Steps to ordination

1. Explore your data: 
  - multivariate data, species abundance or environmental variables, 1 or 2 matrices
2. Prep your data
3. Perform an ordination analysis:
  - Unconstrained to describe 1 matrix
  - Constrained to explain the species matrix by the environmental matrix
4. Interpret the output
5. Plot
6. For constrained ordination: variable selection + test of significance

---
class: inverse, center, middle
# Explore data

---
# Doubs River Fish Dataset

.pull-left[

Verneaux (1973) dataset:
- characterization of fish communities
- 27 different species
- 30 different sites
- 11 environmental variables

]

.pull.right[
![:scale 50%](images/DoubsRiver.png)
]

---
# Doubs River Fish Dataset

Load the Doubs River species data


```r
data(doubs) # available in ade4
spe &lt;- doubs$fish
env &lt;- doubs$env
# remove site with no data
# spe &lt;-  spe[-8]
# env &lt;- env[-8]
```

---
# Explore environmental data


```r
head(env) # first 6 rows
#   dfs alt   slo flo pH har pho nit amm oxy bdo
# 1   3 934 6.176  84 79  45   1  20   0 122  27
# 2  22 932 3.434 100 80  40   2  20  10 103  19
# 3 102 914 3.638 180 83  52   5  22   5 105  35
# 4 185 854 3.497 253 80  72  10  21   0 110  13
# 5 215 849 3.178 264 81  84  38  52  20  80  62
# 6 324 846 3.497 286 79  60  20  15   0 102  53
```

---
# Explore environmental data


```r
pairs(env) 
```

&lt;img src="introR_files/figure-html/unnamed-chunk-5-1.png" style="display: block; margin: auto;" /&gt;

---
# Explore species data


```r
head(spe)
#   Cogo Satr Phph Neba Thth Teso Chna Chto Lele Lece Baba Spbi Gogo Eslu
# 1    0    3    0    0    0    0    0    0    0    0    0    0    0    0
# 2    0    5    4    3    0    0    0    0    0    0    0    0    0    0
# 3    0    5    5    5    0    0    0    0    0    0    0    0    0    1
# 4    0    4    5    5    0    0    0    0    0    1    0    0    1    2
# 5    0    2    3    2    0    0    0    0    5    2    0    0    2    4
# 6    0    3    4    5    0    0    0    0    1    2    0    0    1    1
#   Pefl Rham Legi Scer Cyca Titi Abbr Icme Acce Ruru Blbj Alal Anan
# 1    0    0    0    0    0    0    0    0    0    0    0    0    0
# 2    0    0    0    0    0    0    0    0    0    0    0    0    0
# 3    0    0    0    0    0    0    0    0    0    0    0    0    0
# 4    2    0    0    0    0    1    0    0    0    0    0    0    0
# 5    4    0    0    2    0    3    0    0    0    5    0    0    0
# 6    1    0    0    0    0    2    0    0    0    1    0    0    0
```

---
# Explore species data

Take a look at the distribution of species frequencies  


```r
ab &lt;- table(unlist(spe))
barplot(ab, las = 1, col = grey(5:0/5),
        xlab = "Abundance class", ylab = "Frequency")
```

&lt;img src="introR_files/figure-html/unnamed-chunk-7-1.png" style="display: block; margin: auto;" /&gt;

.alert[Note the proportion of 0s.]

---
# Double zero

**How do we interpret the double absence of species in a matrix of species abundances (or presence-absence)?**

&lt;img style="float: right; width:50%;margin: 1%" src="images/double-zero.png"&gt;
- the *presence* of a species in 2 sites indicates ecological resemblance between these 2 sites 
  - the sites provide a set of minimal conditions allowing the species to survive.

- the *absence* of a species from 2 sites cannot be interpreted as a resemblance because it may be due to a variety of causes: competition, several dimensions of the niche (pH, light, temperature...), random dispersal process.



.alert[A measured 0 (e.g 0mg/L, 0°C) is not the same than a 0 representing an absence of observation]

---
class: inverse, center, middle
# Data preparation

---
# Distance measures

.comment[Ordination analysis are based on the comparison of all possible pairs of objects. 

PCA and RDA are based on the Euclidean distance.]

&lt;br&gt;

Here we want to measure the ecological resemblance (distance or similarity) among sites.

&lt;img style="float: right; width:30%;margin: 1%" src="images/distMes.png"&gt;
- If we compare the sites based on their **environmental variables**, we can use the **Eucidean distance**

- If we compare the sites based on their **species composition**, we don't want to consider double-zero as a similarity. **Euclidean distance is not appropriate**.
  - Solution 1: **Pre-transform** the species matrix to trick the PCA or RDA to use an appropriate distance such as Hellinger.
  - Solution 2: Run a correspondance analysis (CA) which is based on the Chi-square distance
  - Solution 3: Compute a distance matrix from the species matrix and run a PCoA

---
# Standardization of environmental data

Standardizing environmental variables is necessary as you cannot compare the effects of variables with different units


```r
env.z &lt;- decostand(env, method = "standardize")
# env.z &lt;- scale(env)
```

Standardization centers (mean `\(\mu\)` = 0) and scales (standard deviation `\(\sigma\)` = 1) the variables 


```r
apply(env.z, 2, mean)
#           dfs           alt           slo           flo            pH 
#  2.307905e-17  1.814232e-18 -1.196236e-17  4.219715e-17 -5.547501e-18 
#           har           pho           nit           amm           oxy 
#  3.348595e-16  2.662801e-17 -4.104360e-17 -4.357409e-17 -2.636780e-16 
#           bdo 
#  6.859928e-17

apply(env.z, 2, sd)
# dfs alt slo flo  pH har pho nit amm oxy bdo 
#   1   1   1   1   1   1   1   1   1   1   1
```

---
# Transforming species community data

&lt;br&gt;

.center[
![](images/transformation.png)]

---
# Transforming species community data

**Hellinger transformation**


```r
spe.hel &lt;- decostand(spe, method = "hellinger")
```

Other transformation methods:

`method = "chi.square"` ![:faic](arrow-right) when using this transformation in a PCA, the result will be similar to the result of a correspondance analysis (CA)

`method = "normalize"` ![:faic](arrow-right) Chord transformation

`method = "total"` ![:faic](arrow-right)  Species profile transformation

&gt; According to [Legendre &amp; Gallagher](http://adn.biol.umontreal.ca/~numericalecology/Reprints/Legendre_&amp;_Gallagher.pdf): The Hellinger and chord transformations appear to be the best for general use with species data.

---
class: inverse, center, middle
# Unconstrained ordination 
## PCA



---
# Principal Component Analysis (PCA)

- Starting from a multidimensional sites x descriptors matrix 
  - where the descriptors can be species abundance (or presence-absence) or environmental variables

- A PCA will preserve the maximum amount of variation in the data in a reduced number of dimensions (usually we use the first 2 dimensions) 

- The resulting, synthetic variables are orthogonal (i.e. perpendicular and therefore uncorrelated)

.center[
![:scale 70%](images/pca_3d_2d.jpg)]

---
# PCA - Multidimensional case

&lt;br/&gt;&lt;br/&gt;

- **PC1** ![:faic](arrow-right) axis that maximizes the variance of the points that are projected perpendicularly onto the axis.
- **PC2** ![:faic](arrow-right) must be perpendicular to PC1, but the direction is again the one in which variance is maximized when points are perpendicularly projected
- **PC3** ![:faic](arrow-right) and so on: perpendicular to the first two axes

&lt;br/&gt;

.red[For a matrix containing *p* descriptors, a PCA produces a *p* axes which are ordered according to the % of variation of the data they explain]


---
# PCA - Let's try it on the fish dataset!

- For both PCA and RDA, we can use the `rda()` function from the vegan package
  - `rda(Y ~ X)` or `rda(Y, X)` ![:faic](arrow-right) RDA
  - `rda(Y)` or `rda(X)` ![:faic](arrow-right) PCA

---
# PCA

- Run a PCA on the Hellinger-transformed fish data and extract the results


```r
spe.h.pca &lt;- rda(spe.hel)

summary(spe.h.pca)
...
# 
# Call:
# rda(X = spe.hel) 
# 
# Partitioning of variance:
#               Inertia Proportion
# Total          0.5023          1
# Unconstrained  0.5023          1
# 
# Eigenvalues, and their contribution to the variance 
# 
# Importance of components:
#                          PC1     PC2     PC3     PC4     PC5     PC6
# Eigenvalue            0.2491 0.06592 0.04615 0.03723 0.02125 0.01662
# Proportion Explained  0.4959 0.13122 0.09188 0.07412 0.04230 0.03309
# Cumulative Proportion 0.4959 0.62715 0.71903 0.79315 0.83544 0.86853
#                           PC7     PC8     PC9     PC10    PC11     PC12
# Eigenvalue            0.01477 0.01297 0.01054 0.006666 0.00504 0.004258
# Proportion Explained  0.02940 0.02582 0.02098 0.013269 0.01003 0.008477
# Cumulative Proportion 0.89794 0.92376 0.94474 0.958011 0.96804 0.976521
...
```

---
#PCA - Interpretation of Output


```r
summary(spe.h.pca)
...
# Call:
# rda(X = spe.hel) 
# 
# Partitioning of variance:
#               Inertia Proportion
# Total          0.5023          1
# Unconstrained  0.5023          1
...
```

- `Inertia` ![:faic](arrow-right) general term for "variation" in the data.
- Total variance of the dataset (here the fish species) = 0.5023
- In PCA, note that the "Total" and "Unconstrained" portion of the inertia is identical

---
# PCA - Interpretation of Output

&lt;br/&gt;


```r
summary(spe.h.pca)
...
# Eigenvalues, and their contribution to the variance 
# 
# Importance of components:
#                          PC1     PC2     PC3     PC4     PC5     PC6
# Eigenvalue            0.2491 0.06592 0.04615 0.03723 0.02125 0.01662
# Proportion Explained  0.4959 0.13122 0.09188 0.07412 0.04230 0.03309
# Cumulative Proportion 0.4959 0.62715 0.71903 0.79315 0.83544 0.86853
...
```

- `Eigenvalue` ![:faic](arrow-right) measures the amount of variation represented by each ordination axe (Principal Component or PC)
- One eigenvalue associated to each PC (in this output there are 27 PCs, as this is the number of species)


&lt;br/&gt;

.center[**0.2491 + 0.06592 + ... = 0.5023 Total inertia**]

---
# PCA - Interpretation of Output


```r
summary(spe.h.pca)
...
# Call:
# rda(X = spe.hel) 
# 
# Partitioning of variance:
#               Inertia Proportion
# Total          0.5023          1
# Unconstrained  0.5023          1
# 
# Eigenvalues, and their contribution to the variance 
# 
# Importance of components:
#                          PC1     PC2     PC3     PC4     PC5     PC6
# Eigenvalue            0.2491 0.06592 0.04615 0.03723 0.02125 0.01662
# Proportion Explained  0.4959 0.13122 0.09188 0.07412 0.04230 0.03309
# Cumulative Proportion 0.4959 0.62715 0.71903 0.79315 0.83544 0.86853
...
```


- `Proportion Explained` ![:faic](arrow-right) proportion of variation accounted for, by dividing the eigenvalues by the total inertia.

&lt;br/&gt;

.center[**0.2491/0.5023 = 0.4959 or 49.59%**]


---
# PCA - Interpretation of Output


```r
summary(spe.h.pca)
...
# Species scores
# 
#           PC1      PC2       PC3        PC4       PC5        PC6
# Cogo  0.17113  0.08669 -0.060772  0.2536941 -0.027774  0.0129709
# Satr  0.64097  0.02193 -0.232895 -0.1429053 -0.059150  0.0013299
# Phph  0.51106  0.19774  0.165053  0.0203364  0.105582  0.1226508
# Neba  0.38002  0.22219  0.235145 -0.0344577  0.126570  0.0570437
# Thth  0.16679  0.06494 -0.087248  0.2444247  0.016349  0.0537362
# Teso  0.07644  0.14707 -0.041152  0.2304754 -0.104984 -0.0424943
# Chna -0.18392  0.05238 -0.042963  0.0222676  0.071349  0.0299974
# Chto -0.14601  0.17844 -0.029561  0.0622957 -0.002615 -0.0839282
...
```


- `Species scores` ![:faic](arrow-right) coordinates of all descriptors in the multidimensional space of the PCA. 

&lt;br&gt;

- Species always refers to your descriptors (the columns in your matrix), here the fish species. Even if you run a PCA on environmental variables, the descriptors will still be called Species scores

---
# PCA - Interpretation of Output


```r
summary(spe.h.pca)
...
# Site scores (weighted sums of species scores)
# 
#          PC1      PC2       PC3      PC4       PC5       PC6
# 1   0.370801 -0.49113 -1.018411 -0.58387 -0.491672 -0.622062
# 2   0.507019 -0.05688 -0.175969 -0.42418  0.407790  0.160725
# 3   0.464652  0.02937 -0.067360 -0.49566  0.324339  0.313053
# 4   0.299434  0.19037  0.241315 -0.54538  0.009838  0.197974
# 5  -0.003672  0.13483  0.515723 -0.53640 -0.796183 -0.208554
# 6   0.212943  0.16142  0.538108 -0.44366 -0.138553 -0.066196
# 7   0.440596 -0.01853  0.174782 -0.31336  0.171713  0.131172
# 8   0.032182 -0.53492 -0.354289 -0.07870 -0.125287 -0.632592
...
```

- `Site scores` ![:faic](arrow-right) coordinates of all sites in the multidimensional space of the PCA. 

&lt;br&gt;

- Site refers to the rows in your dataset, here the different sites along the Doubs river (but it can be points in time, etc)




---
# Selecting Important PCs

Select PCs which capture more variance than the average (Kaiser-Guttman criterion)



```r
ev &lt;- spe.h.pca$CA$eig # extract eigenvalues
barplot(ev, main = "Eigenvalues", col = "grey", las = 2)
abline(h = mean(ev), col = "red3", lwd = 2)
```

&lt;img src="introR_files/figure-html/unnamed-chunk-17-1.png" style="display: block; margin: auto;" /&gt;


---
# PCA - environmental variables

We can also run PCAs on standardized environmental variables, to compare environmental conditions of sites or how environmental variables are correlated...

- Run a PCA on the standardized environmental variables and extract the results

```r
env.pca &lt;- rda(env.z)
summary(env.pca)
...
# 
# Call:
# rda(X = env.z) 
# 
# Partitioning of variance:
#               Inertia Proportion
# Total              11          1
# Unconstrained      11          1
# 
# Eigenvalues, and their contribution to the variance 
# 
# Importance of components:
#                          PC1    PC2     PC3     PC4     PC5     PC6
# Eigenvalue            6.3216 2.2316 1.00420 0.50068 0.37518 0.24797
# Proportion Explained  0.5747 0.2029 0.09129 0.04552 0.03411 0.02254
# Cumulative Proportion 0.5747 0.7776 0.86886 0.91437 0.94848 0.97102
#                           PC7      PC8     PC9     PC10      PC11
# Eigenvalue            0.16647 0.107161 0.02354 0.017259 0.0043137
# Proportion Explained  0.01513 0.009742 0.00214 0.001569 0.0003922
# Cumulative Proportion 0.98616 0.995898 0.99804 0.999608 1.0000000
...
```

---
# PCA - environmental variables

- Plot the eigenvalues above average


```r
ev &lt;- env.pca$CA$eig # extract eigenvalues
barplot(ev, main = "Eigenvalues", col = "grey", las = 2)
abline(h = mean(ev), col = "red3", lwd = 2)
```

&lt;img src="introR_files/figure-html/unnamed-chunk-19-1.png" style="display: block; margin: auto;" /&gt;

---
# PCA - Visualization

The abundance of information produced by PCA is easier to understand and interpret using biplots to visualize patterns

- We can produce a quick biplot of the PCA using the function `biplot()` in base R


```r
biplot(spe.h.pca)
```

&lt;img src="introR_files/figure-html/unnamed-chunk-20-1.png" style="display: block; margin: auto;" /&gt;

---
# PCA - Scaling


```r
biplot(spe.h.pca, scaling = 1, main = "Scaling 1 = distance biplot")
biplot(spe.h.pca, scaling = 2, main = "Scaling 2 = correlation biplot")
```

&lt;img src="introR_files/figure-html/unnamed-chunk-21-1.png" style="display: block; margin: auto;" /&gt;

- In a PCA, we interpret the .purple[**correlation among species**] by looking at the angles among their arrows, while we interpret the .purple[**distance among sites**]. 

- However, we cannot optimally display sites and species together in a PCA biplot. 

---
# PCA - Scaling

&lt;img src="introR_files/figure-html/unnamed-chunk-22-1.png" style="display: block; margin: auto;" /&gt;

.pull-left[
**Scaling 1**: 
- distances among objects are approximations of Euclidean distances; 
- the angles among descriptors vector are meaningless.

.alert[Best for interpreting relationships among objects (sites)!]
]

.pull-right[**Scaling 2** (Default): 
- angles between descriptors vectors reflect their correlations; 
- distances among objects are not approximations of Euclidean distances.

.alert[Best for interpreting relationships among descriptors (species)!]
]

---
# Customized biplot

- Extract species and site scores along the 1st and 2nd PC:

```r
spe.scores &lt;- scores(spe.h.pca, display = "species", choices = 1:2)

site.scores &lt;- scores(spe.h.pca, display = "sites", choices = 1:2)
```

- Extract % of variation on the 1st and 2nd PC: 

```r
prop1 &lt;- round(spe.h.pca$CA$eig[1]/sum(spe.h.pca$CA$eig)*100, 2)
prop2 &lt;- round(spe.h.pca$CA$eig[2]/sum(spe.h.pca$CA$eig)*100, 2)
```

---
# Customized biplot

Empty plot with informative axis labels

```r
plot(spe.h.pca, type = "none",
     xlab = paste0("PC1 (", prop1, "%)"),
     ylab = paste0("PC2 (", prop2, "%)"))
```

&lt;img src="introR_files/figure-html/unnamed-chunk-25-1.png" style="display: block; margin: auto;" /&gt;

---
# Customized biplot

Add points for sites

```r
points(site.scores,
       pch = 21, bg = "steelblue", cex  = 1.2)
```

&lt;img src="introR_files/figure-html/unnamed-chunk-26-1.png" style="display: block; margin: auto;" /&gt;

---
# Customized biplot

Add arrows for species

```r
arrows(x0 = 0, y0 = 0, 
       x1 = spe.scores[,1], y1 = spe.scores[,2], 
       length = 0.1) # size of arrow head
```

&lt;img src="introR_files/figure-html/unnamed-chunk-27-1.png" style="display: block; margin: auto;" /&gt;

---
# Customized biplot

Add labels for species

```r
text(spe.scores[,1], spe.scores[,2],
     labels = rownames(spe.scores),
     col = "red3", cex = 0.8)
```

&lt;img src="introR_files/figure-html/unnamed-chunk-28-1.png" style="display: block; margin: auto;" /&gt;


---
# Customized biplot

Complete code for the biplot

```r
plot(spe.h.pca, type = "none",
     xlab = paste0("PC1 (", prop1, "%)"),
     ylab = paste0("PC2 (", prop2, "%)"))
points(site.scores,
       pch = 21, bg = "steelblue", cex  = 1.2)
arrows(x0 = 0, y0 = 0, 
       x1 = spe.scores[,1], y1 = spe.scores[,2], 
       length = 0.1)
text(spe.scores[,1], spe.scores[,2],
     labels = rownames(spe.scores),
     col = "red3", cex = 0.8)
```

---
class: inverse, center, middle

# Constrained ordinations

## Redundancy analysis - RDA

---
# RDA

- RDA = combination of multiple regressions and a PCA.
  
- It allow us to identify and test relationships between a response matrix and explanatory matrix or matrices

.center[ ![:scale 60%](images/RDA.png)]
  
- Explanatory variables can be quantitative, qualitative, or binary (0/1).

&lt;br&gt;
- .alert[Transform] species data and .alert[standardize] quantitative variables prior to running a RDA.

---
# Run the RDA

- Model the effect of all environmental variables on fish community composition


```r
spe.rda &lt;- rda(spe.hel ~., data = env.z) # "~." indicates all variables
# or spe.rda &lt;- rda(X = spe.hel, Y = env.z)
```

- .comment[It is better to use the formula interface which is more flexible (allows for factors and interaction among variables)], for example: `rda(spe.hel ~ var1 + var2*var3 + fac, data = env.z)`.
- You can also control for a group of variables, for example you are interested in the effect var1,2,3 while holding constant var4,5:  `rda(spe.hel ~ var1 + var2*var3 + Condition(var4 + var5), data = env.z)`

---
# RDA output in R


```r
summary(spe.rda)
...
# 
# Call:
# rda(X = spe.hel, Y = env.z) 
# 
# Partitioning of variance:
#               Inertia Proportion
# Total          0.5023     1.0000
# Constrained    0.3557     0.7081
# Unconstrained  0.1467     0.2919
...
```

- **`Constrained Proportion`** ![:faic](arrow-right) variance of the response matrix explained by the environmental matrix
 - .alert[(0.3557/0.5023 = 70.81%)]
 - Equivalent of unadjusted R2
- **`Unconstained Proportion`** ![:faic](arrow-right) unexplained variance in the response matrix
  - .alert[(0.1467/0.5023 = 29.21%)]  
  
  


---
# RDA output in R


```r
summary(spe.rda)
...
# Eigenvalues, and their contribution to the variance 
# 
# Importance of components:
#                         RDA1   RDA2    RDA3    RDA4     RDA5     RDA6
# Eigenvalue            0.2218 0.0545 0.03245 0.02186 0.009033 0.006009
# Proportion Explained  0.4415 0.1085 0.06460 0.04351 0.017983 0.011962
# Cumulative Proportion 0.4415 0.5500 0.61463 0.65814 0.676119 0.688082
#                           RDA7     RDA8     RDA9     RDA10     RDA11
# Eigenvalue            0.003783 0.002822 0.001944 0.0008515 0.0006343
# Proportion Explained  0.007532 0.005618 0.003869 0.0016951 0.0012628
# Cumulative Proportion 0.695614 0.701231 0.705100 0.7067955 0.7080583
#                           PC1     PC2     PC3     PC4     PC5      PC6
# Eigenvalue            0.04218 0.02887 0.01910 0.01363 0.01060 0.008346
# Proportion Explained  0.08396 0.05746 0.03801 0.02713 0.02111 0.016615
# Cumulative Proportion 0.79202 0.84948 0.88749 0.91462 0.93573 0.952346
...
```

- **`Eigenvalues, and their contribution to the variance`** ![:faic](arrow-right) eigenvalues for the canonical axes (RDA1 to RDA11) and the unconstrained axes (PC1 to PC18), as well as the cumulative proportion of .purple[**variance explained by the RDA axes**] and .purple[**represented by the residual PC axes**].
- The first 2 RDA axes cumulatively explain 55% of the fish community variance.

---
# Selecting variables

Using .alert[stepwise selection], we can select the explanatory variables that are significant.  
  


```r
# Forward selection of variables:
mod0 &lt;- rda(spe.hel ~ 1, data = env.z)  # Model with intercept only
rda.sel &lt;- ordiR2step(mod0, # lower model limit
               scope = formula(spe.rda), # upper model limit (full model)
               direction = "forward", # could be backward or both
               R2scope = TRUE, # can't surpass the full model's R2
               step = 1000,
               trace = FALSE) # change to TRUE to see the selection process!
```

.comment[Here, we are essentially adding one variable at a time, and retaining it if it significantly increases the model's adjusted R2.]

---
# Selecting variables

- Which variables are retained by the forward selection?

```r
rda.sel$call
# rda(formula = spe.hel ~ dfs + oxy + bdo, data = env.z)
```


- What is the **adjusted R2** of the RDA with the selected variables?

```r
RsquareAdj(rda.sel)
# $r.squared
# [1] 0.5645572
# 
# $adj.r.squared
# [1] 0.5143137
```

How would you report these results in a paper?  
- .comment[The selected environmental variables (dfs + oxy + bdo) explain .alert[51.43%] of the variation in fish community composition in the 30 sites along the Doubs river.]
- Note: you should report the adjusted R2 which takes into account the number of explanatory variables.

---
# Significance testing

Use `anova.cca()` to test the significance of your RDA.

```r
anova.cca(rda.sel, step = 1000)
# Permutation test for rda under reduced model
# Permutation: free
# Number of permutations: 999
# 
# Model: rda(formula = spe.hel ~ dfs + oxy + bdo, data = env.z)
#          Df Variance      F Pr(&gt;F)    
# Model     3  0.28360 11.236  0.001 ***
# Residual 26  0.21874                  
# ---
# Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```

You can also test the significance of each axis!

```r
anova.cca(rda.sel, step = 1000, by = "axis")
```

You can also test the significance of each variable!

```r
anova.cca(rda.sel, step = 1000, by = "term")
```

&gt; The interpretation of the RDA must be preceded by a test of statistical significance. If your test is not significant, results should not be interpreted.

---
# RDA - Visualization

The RDA allows the **simultaneous visualization** of your response and explanatory variables


```r
ordiplot(rda.sel, scaling = 1, type = "text")
ordiplot(rda.sel, scaling = 2, type = "text")
```

&lt;img src="introR_files/figure-html/unnamed-chunk-39-1.png" style="display: block; margin: auto;" /&gt;

.pull-left[
**Scaling 1** distances among objects reflect their similarities
]

.pull-right[
**Scaling 2** angles between variables (species and explanatory variables) reflect their correlation
]

---
# RDA triplot - Scaling

### Scaling 1 – .comment[distance triplot]

.pull-left[
&lt;img src="introR_files/figure-html/unnamed-chunk-40-1.png" style="display: block; margin: auto;" /&gt;
]

.pull-right[
- .alert[Distances among sites] approximate their Euclidean distances, i.e. sites that are close together share similar species. Idem for centroids of qualitative variables.
- .alert[Projecting a site at right angle] on a response variable or a quantitative explanatory variable approximates the value of the site along that variable.
- The .alert[angles between response and explanatory variables] reflect their correlations (*but not the angles among response variables*).  
]
---
# RDA triplot - Scaling

### Scaling 2 - .comment[correlation triplot]

.pull-left[
&lt;img src="introR_files/figure-html/unnamed-chunk-41-1.png" style="display: block; margin: auto;" /&gt;
]

.pull-right[
- The .alert[angles between *all* vector variables] reflect their correlations.
- Distances among sites do **not** approximate their Euclidean distances. Idem for centroids of qualitative variables.
- .alert[Projecting a site at right angle] on a response variable or a quantitative explanatory variable approximates the value of the site along that variable.
- Environmental arrows that are .alert[along the first axis and longer]  are more important to explain the variation in the community matrix.     
]

---
## Customizing RDA triplot

Both `plot()` and `ordiplot()` make quick and simple ordination plots, but you can customize your plots by manually setting the aesthetics of points, text, and arrows.

- Extract species and site scores along the 1st and 2nd RDA:

```r
spe.scores &lt;- scores(rda.sel, display = "species", choices = 1:2) 
site.scores &lt;- scores(rda.sel, display = "sites", choices = 1:2)
env.scores &lt;- scores(rda.sel, display = "bp", choices= 1:2)
# default: scaling = 2
```

- Extract % of variation on the 1st and 2nd RDA: 

```r
prop1 &lt;- round(rda.sel$CCA$eig[1]/sum(rda.sel$CCA$eig)*100, 2)
prop2 &lt;- round(rda.sel$CCA$eig[2]/sum(rda.sel$CCA$eig)*100, 2)
```
---
# Customizing RDA triplot


```r
# Empty plot with axes
plot(rda.sel, type = "none",
     xlab = paste0("RDA1 (", prop1, "%)"),
     ylab = paste0("RDA2 (", prop2, "%)"))

# Points for sites
points(site.scores,
       pch = 19, col = alpha("grey", 0.5), cex  = 1.1)

# Arrows and text for species
arrows(x0 = 0, y0 = 0, 
       x1 = spe.scores[,1], y1 = spe.scores[,2], 
       length = 0.1, col = "grey15")
text(spe.scores[,1], 
     spe.scores[,2]+sign(spe.scores[,2])*.02, # shift labels
     labels = rownames(spe.scores),
     col = "grey15", cex = 0.9)

# Arrows and text for environmental variables
arrows(x0 = 0, y0 = 0, 
       x1 = env.scores[,1], y1 = env.scores[,2], 
       length = 0.1, lwd = 1.5, col = "#CC3311")
text(env.scores[,1]+sign(env.scores[,1])*.05, # shift labels
     env.scores[,2],
     labels = rownames(env.scores),
     col = "#CC3311", cex = 1, font = 2)
```


---
# Customizing RDA triplot

&lt;img src="introR_files/figure-html/unnamed-chunk-45-1.png" style="display: block; margin: auto;" /&gt;

---
# Customizing RDA triplot


```r
spe.scores &lt;- spe.scores * 1.4
```

&lt;img src="introR_files/figure-html/unnamed-chunk-46-1.png" style="display: block; margin: auto;" /&gt;


---
class: inverse, center, middle

# Thank you for attending this workshop!
    </textarea>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="inSileco-macros.js"></script>
<script>var slideshow = remark.create({
"highlightLines": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function() {
  var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})();</script>

<script>
(function() {
  var i, text, code, codes = document.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
})();
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
